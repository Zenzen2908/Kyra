<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="HandheldFriendly" content="true">
    <title>Application</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/28e3060a5c.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="appfor">
        <form action="#" method="post">
            <h2 class="headap">APPLICATION FORM</h2>
            <h4><i class="fa-solid fa-circle-user"></i> Personal Information</h4>
            <div class="form-group row">
                <div class="col-5 input">
                    <label for="fname" class="text--light">First Name</label>
                    <input type="text" id="fname" name="fname" class="form-control" required>
                </div>
                <div class="col-5 input">
                    <label for="lname">Last Name</label>
                    <input type="text" id="lname" name="lname" class="form-control" required>
                </div>
                <div class="col-2">
                    <label for="mi">M.I.</label>
                    <input type="text" id="mi" name="mi" class="form-control" required>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-4 input">
                    <label for="mail">Email</label>
                    <input type="email" id="mail" name="mail" class="form-control" required>
                </div>
                <div class="col-4 input">
                    <label for="num">Phone Number</label>
                    <input type="number" id="num" name="num" class="form-control" required>
                </div>
                <div class="col-2 input">
                    <label for="bday">Birthdate</label>
                    <input type="date" id="bday" name="bday" class="form-control" required>
                </div>
                <div class="col-1 input">
                    <label for="age">Age</label>
                    <input type="number" id="age" name="age" class="form-control" required>
                </div>
                <div class="col">
                    <label for="sex">Sex</label>
                    <select class="custom-select mr-sm-2" name="sex" id="sex">
                        <option value="F">F</option>
                        <option value="M">M</option>
                    </select>
                </div>
            </div>
            <h4><i class="fa-solid fa-location-dot"></i> Home Address</h4>
            <div class="form-group row">
                <div class="col input">
                    <label for="adrs">Street/House No./Building No./Village/Subd.</label>
                    <input type="text" id="adrs" name="adrs" class="form-control" required>
                </div>
                <div class="col-3">
                    <label for="brgy">Baranggay</label>
                    <input type="text" id="brgy" name="brgy" class="form-control" required>
                </div>
            </div>
            <div class="form-group row">
                <div class="col input">
                    <label for="city">City</label>
                    <input type="text" id="city" name="city" class="form-control" required>
                </div>
                <div class="col input">
                    <label for="prov">Province</label>
                    <input type="text" id="prov" name="prov" class="form-control" required>
                </div>
                <div class="col-2">
                    <label for="zip">Zipcode</label>
                    <input type="text" id="zip" name="zip" class="form-control" required>
                </div>
            </div>
            <!-- End of Applicant's Basic Info -->
            <h4 class="edwe">Educational Background</h4>
            <div class="form-group row text-center hdr">
                <div class="col">
                    <h6>School</h6>
                </div>
                <div class="col">
                    <h6>Address</h6>
                </div>
                <div class="col">
                    <h6>Degree</h6>
                </div>
                <div class="col-2">
                    <h6>Year Graduated</h6>
                </div>
                <div class="col-1"></div>
            </div>
            <div id="row_item">
                <div class="form-group row">
                    <div class="col input">
                        <input type="text" name="sch[]" class="form-control">
                    </div>
                    <div class="col input">
                        <input type="text" name="add[]" class="form-control">
                    </div>
                    <div class="col input">
                        <input type="text" name="dgre[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="number" name="yg[]" class="form-control">
                    </div>
                    <div class="col-1">
                        <button type="button" class="btn btn-success btn-inline add_row_btn"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
            </div>
            <!-- End of Applicant's Educational Background -->
            <h2 class=" edwe">Work Experience</h2>
            <div class="form-group row text-center hdr">
                <div class="col">
                    <h6>Company</h6>
                </div>
                <div class="col">
                    <h6>Position</h6>
                </div>
                <div class="col-2">
                    <h6>Date Started</h6>
                </div>
                <div class="col-2">
                    <h6>Date Ended</h6>
                </div>
                <div class="col-2">
                    <h6>Length of Service </h6>
                </div>
                <div class="col-1">
                </div>
            </div>
            <div id="item_field">
                <div class="form-group row">
                    <div class="col input">
                        <input type="text" name="comp[]" class="form-control">
                    </div>
                    <div class="col input">
                        <input type="text" name="pos[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="date" name="ds[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="date" name="de[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="number" name="ls[]" class="form-control">
                    </div>
                    <div class="col-1">
                        <button type="button" class="btn btn-success btn-inline add_btn"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
            </div>
            <button class="subbot" id="sub_bot" name="submit">Submit</button>
        </form>
    </div>

    <?php
    include 'database.php';
    if (isset($_POST['submit'])) {
        $fn = $_POST['fname'];
        $ln = $_POST['lname'];
        $mi = $_POST['mi'];
        $mail = $_POST['mail'];
        $num = $_POST['num'];
        $bday = $_POST['bday'];
        $age = $_POST['age'];
        $sex = $_POST['sex'];
        $adrs = $_POST['adrs'];
        $brgy = $_POST['brgy'];
        $city = $_POST['city'];
        $prov = $_POST['prov'];
        $zip = $_POST['zip'];

        //application = tablename
        //FirstName, LastName.... = Column Names
        $sql1 = $conn->prepare("INSERT INTO app(FirstName,LastName,MI,Email,PhoneNumber,Birthdate,Age,Sex,Adrs, Baranggay, City, Province, Zipcode) 
                            VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
        $sql1->bind_param("sssssssssssss", $fn, $ln, $mi, $mail, $num, $bday, $age, $sex, $adrs, $brgy, $city, $prov, $zip);
        $sql1->execute();

        $query3 = mysqli_query($conn, "SELECT MAX(ApplicationNo) AS LastAppNo FROM app");
        while ($result2 = mysqli_fetch_assoc($query3)) {
            $last_id =  $result2['LastAppNo'];
        };

        $sch = $_POST['sch'];
        $add = $_POST['add'];
        $dgre = $_POST['dgre'];
        $yg = $_POST['yg'];

        foreach ($sch as $key => $value) {
            $save = "INSERT INTO educ_attained(ApplicationNo,School,School_Add,Degree,Year_Grad) 
                    VALUES('" . $last_id . "','" . $value . "','" . $add[$key] . "','" . $dgre[$key] . "','" . $yg[$key] . "')";

            $query = mysqli_query($conn, $save);
        }

        $comp = $_POST['comp'];
        $pos = $_POST['pos'];
        $ds = $_POST['ds'];
        $de  = $_POST['de'];
        $ls = $_POST['ls'];


        foreach ($comp as $key => $value) {
            $worksave = "INSERT INTO workexp(ApplicationNo,Company,Position,DateStart,DateEnd,LengthService) 
                    VALUES('" . $last_id . "','" . $value . "','" . $pos[$key] . "','" . $ds[$key] . "','" . $de[$key] . "','" . $ls[$key] . "')";

            $workquery = mysqli_query($conn, $worksave);
        }
        if ($sql1 and $query and $workquery === TRUE) {
            echo "<script> window.location.href = 'index.php';</script>";
        } else {
            die(mysqli_error($conn));
        }
    }
    ?>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $(".add_row_btn").click(function(e) {
                e.preventDefault();
                $("#row_item").append(`
                <div class="form-group row">
                    <div class="col input">
                        <input type="text" name="sch[]" class="form-control">
                    </div>
                    <div class="col input">
                        <input type="text" name="add[]" class="form-control">
                    </div>
                    <div class="col input">
                        <input type="text" name="dgre[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="number" name="yg[]" class="form-control">
                    </div>
                    <div class="col-1">
                        <button type="button" class="btn btn-danger btn-inline rem_row_btn"><i class="fa-solid fa-minus"></i></button>
                    </div>
                </div>`)
            });

            $(document).on('click', '.rem_row_btn', function(e) {
                e.preventDefault();
                let row_item = $(this).parent().parent();
                $(row_item).remove();
            });
        });

        $(document).ready(function() {
            $(".add_btn").click(function(e) {
                e.preventDefault();
                $("#item_field").append(`
                <div class="form-group row">
                    <div class="col input">
                        <input type="text" name="comp[]" class="form-control">
                    </div>
                    <div class="col input">
                        <input type="text" name="pos[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="date" name="ds[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="date" name="de[]" class="form-control">
                    </div>
                    <div class="col-2 input">
                        <input type="number" name="ls[]" class="form-control">
                    </div>
                    <div class="col-1">
                        <button type="button" class="btn btn-danger btn-inline rem_btn"><i class="fa-solid fa-minus"></i></button>
                    </div>
                </div>`)
            });

            $(document).on('click', '.rem_btn', function(e) {
                e.preventDefault();
                let item_field = $(this).parent().parent();
                $(item_field).remove();
            });
        });
    </script>
</body>

</html>
